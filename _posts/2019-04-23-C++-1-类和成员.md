---
title: C++-类和成员
date: 2019-04-23
categories:
- Tech
- C++
tags:
- blog
- C++
- Member
---


类的成员  

是否共享：  
1，类的每个对象分别拥有单独的一份成员  
2，类的每个对象共同拥有同一个成员  

所属关系  
1，类的成员在类内部定义，完全拥有此成员  
   此时，类的成员和类的对象的生命周期相同  
2，类的成员在类外部定义，拥有对成员的访问权  
   此时，类的对象仅仅拥有对成员的访问权，不管理成员的生命周期  
3，类的成员在类外部定义，管理成员的生命周期  
   此时，类的对象管理类的成员的生命周期  
   也即是说，类的对象和类的成员的生命周期相同  

拥有，表示既可以访问，也掌管其生命周期，一般是具有共同的生命周期。  
引用，只具有访问权，不掌管生命周期，也就是，成员实体和对象的创建和销毁是分别执行的。  
不过，智能指针类型的成员，不会随着单独某个对象的销毁而销毁，  
而是当计数为0后才会销毁。  

成员的类型    
- 普通对象  
- 普通指针  
- 引用  
- 智能指针  

如果成员是普通对象  
那么，这个类的每个对象分别拥有单独的一份成员  
每个对象负责各自的成员的生命周期  

如果成员是普通指针  
那么，类的对象可以单独拥有，也可以共同引用，也可以部分引用  
此时，成员只能在外部定义  

如果成员是引用  
那么，他们的关系也是引用   
此时，成员只能在外部定义  

如果成员是智能指针  
那么，他们的关系是引用   
此时，成员只能在外部定义  
其生命周期，不会随着单独某个对象的销毁而销毁，  
而是当计数为0后才会销毁。  

对于一些共享资源，比如文件描述符，任务体，消息体，数据  
可能需要在全局只保存一份，而需要多个对象都可以引用这些共享资源  
那么，可以使用普通指针和智能指针作为成员的类型  

为什么不使用引用呢？  
引用作为本地变量的一个别名，适用于本地函数栈调用中的传参，  
对于不同线程，多个执行体，通常处于不同的栈空间，虽然也可访问，但栈的生存周期是不定的，当然可以使用同步方式，这样做的话又增加一层业务逻辑和处理逻辑之外的一个同步，引起不必要的复杂性。    


优选智能指针，其可以进行一些资源管理，减少在业务逻辑的资源管理部分的思考和代码。  
智能指针的实现  
本质上智能指针是个类，它和普通指针的关系也可以用以上描述类和成员的关系进行描述  
不过，智能智能类中普通指针的定义都是在类内部进行的。  
不同的智能指针的实现只有生命周期管理的不同，从而导致其使用方式的不同。  


智能指针成员的使用  
在类外部定义智能指针对象
赋予类的成员，或作为构造函数或初始化函数的参数传递进去  
然后像普通指针一样进行访问  

其中的资源管理就被智能指针接管了。  


智能指针的使用引起的问题  
对象的定义的步骤繁琐  
循环引用导致对象未完全析构  


循环引用问题，使用特殊的智能指针的定义和使用方式，从而使得对象可完全析构。  
对象定义步骤的繁琐，可以使用依赖注入，来达到对象的方便的定义。  

不过，依赖注入又需要多一层的处理。  

